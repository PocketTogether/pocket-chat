```
pnpm i -D vite-plugin-pwa
```

然后在 `vite.config.ts` 中加入：
```ts
import { VitePWA } from 'vite-plugin-pwa'

export default {
  plugins: [
    VitePWA({
      registerType: 'autoUpdate',
      includeAssets: ['favicon.png'],
      manifest: {
        name: 'PocketChat',
        short_name: 'Chat',
        start_url: '/',
        display: 'standalone',
        icons: [
          {
            src: 'pwa-icon-192.png',
            sizes: '192x192',
            type: 'image/png',
            purpose: 'any',
          },
          {
            src: 'pwa-icon-512.png',
            sizes: '512x512',
            type: 'image/png',
            purpose: 'any',
          },
          {
            src: 'pwa-icon-192.png',
            sizes: '192x192',
            type: 'image/png',
            purpose: 'maskable',
          },
          {
            src: 'pwa-icon-512.png',
            sizes: '512x512',
            type: 'image/png',
            purpose: 'maskable',
          },
        ],
        background_color: '#7899CC',
        theme_color: '#7899CC',
        screenshots: [
          {
            src: 'Snipaste_2026-01-18_17-30-48.jpg',
            sizes: '1920x1080',
            type: 'image/jpeg',
            form_factor: 'wide',
          },
          {
            src: 'Snipaste_2026-01-19_20-39-40.jpg',
            sizes: '900x1440',
            type: 'image/jpeg',
            form_factor: 'wide',
          },
          {
            src: 'Snipaste_2026-01-19_20-41-08.jpg',
            sizes: '537x1165',
            type: 'image/jpeg',
          },
        ],
      },
    }),
  ]
}
```

```
, "purpose": "maskable"
```

```
import { registerSW } from 'virtual:pwa-register';

registerSW({ immediate: true });
```

```
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180" />
```

暂时先不设置文件缓存，先跑起来
```
设置缓存计划
图标缓存 /remixicon
文件缓存 /api/files/
api缓存 /api/collections/ 只在离线时生效
```

```ts
VitePWA({
  registerType: 'autoUpdate',
  includeAssets: ['favicon.png'],
  manifest: {
    /* ... */
  },
  workbox: {
    // navigateFallback: null,
    navigateFallbackDenylist: [
      // PocketBase API (File)
      /^\/api\//,
      // PocketBase Admin UI
      /^\/_\//,
    ],
    runtimeCaching: [
      // 1. 图标缓存 /remixicon
      {
        urlPattern: ({ url }) => url.pathname.startsWith('/remixicon'),
        handler: 'CacheFirst',
        options: {
          cacheName: 'remixicon-cache',
          expiration: {
            maxEntries: 20,
            maxAgeSeconds: 60 * 60 * 24 * 180,
          },
          cacheableResponse: {
            statuses: [0, 200],
          },
        },
      },

      // 2. 文件缓存 /api/files/
      {
        urlPattern: ({ url }) => url.pathname.startsWith('/api/files/'),
        handler: 'CacheFirst',
        options: {
          cacheName: 'files-cache',
          expiration: {
            maxEntries: 200,
            maxAgeSeconds: 60 * 60 * 24 * 180,
          },
          cacheableResponse: {
            statuses: [0, 200],
          },
        },
      },

      // 3. API 缓存 /api/collections/（只在离线时生效）
      {
        urlPattern: ({ url }) =>
          url.pathname.startsWith('/api/collections/'),
        handler: 'NetworkFirst',
        options: {
          cacheName: 'api-cache',
          networkTimeoutSeconds: 0,
          expiration: {
            maxEntries: 200,
            maxAgeSeconds: 60 * 60 * 24 * 10,
          },
          cacheableResponse: {
            statuses: [0, 200],
          },
        },
      },
    ],
  },
})

```

