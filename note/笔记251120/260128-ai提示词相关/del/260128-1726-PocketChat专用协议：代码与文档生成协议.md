下面给你一份**完全为 PocketChat 项目量身定制的《PocketChat 专用协议：代码与文档生成协议》**。  
它不是通用协议，而是**深度结合你项目的技术栈、目录结构、编码习惯、工具链、草稿体系、dev-flatten-text-to-ai.js 工作流、i18n 体系、API 封装习惯、TanStack Query 习惯、组件结构习惯**等所有你在文档中体现的工程风格。

这份协议可以直接放进：

```
E:/Project/pocket-chat/note/草稿260113/260128-提示词相关研究/
```

作为你未来所有 AI 交互的“PocketChat 专用 Prompt 协议”。

---

# 📘 **PocketChat 专用协议：代码与文档生成协议（PocketChat Code & Doc Generation Protocol）**

**Version:** 1.0  
**Author:** Haruki（with Copilot）  
**Scope:**  
适用于 PocketChat 项目中所有与 AI 相关的：

- 代码生成
- 文档生成
- 代码重构
- 目录结构规划
- API 封装
- 组件拆分
- i18n 文案生成
- TanStack Query 封装
- PocketBase SDK 使用
- 草稿内容压缩与总结
- dev-flatten-text-to-ai.js 输入工作流

---

# 1. 总则（General Rules）

## 1.1 AI 必须遵守 PocketChat 的工程风格

包括但不限于：

- Vue3 + TS + `<script setup>`
- 组件命名 PascalCase
- TS 文件 kebab-case
- 文件夹 kebab-case
- 目录中使用 `index.ts` 统一导出
- 使用 `dependencies.ts` 管理上级导入
- 组合式函数放在 `src/composables`
- 组件拆分放在 `components/`
- TanStack Query 的 useXxxQuery 放在 `src/queries`
- API 封装放在 `src/api`
- i18n 文案使用 `i18nStore.t('xxx')()`

AI 必须严格遵守这些风格，不得自行发明结构。

---

## 1.2 AI 不得：

- 输出未被要求的文件
- 修改未被要求的文件
- 生成与 PocketChat 风格不一致的代码
- 使用未在项目中出现的库
- 使用未在项目中出现的目录结构
- 生成不符合 TS/ESLint 习惯的代码

---

## 1.3 AI 必须：

- 保持代码可运行
- 保持类型安全
- 保持目录结构一致
- 保持导出方式一致
- 保持 i18n 文案格式一致
- 保持 API 封装风格一致

---

# 2. 输入协议（Input Protocol）

PocketChat 的输入通常来自：

- 草稿目录
- README_CN.md
- 讨论文档
- dev-flatten-text-to-ai.js flatten 后的内容

## 2.1 输入模式启动

用户发送：

```
接下来我会分批输入 PocketChat 项目的内容，你只需记录，不要分析。
每段输入后回复「已记录第X段」。
当我说「全部输入完毕」时，等待下一步指令。
```

AI 必须回复：

```
已进入 PocketChat 输入模式
```

---

## 2.2 输入格式

每段必须使用：

```
【第X段开始】
...内容...
【第X段结束】
```

AI 回复：

```
已记录第X段
```

---

## 2.3 输入结束

用户：

```
全部输入完毕
```

AI：

```
已记录全部 PocketChat 内容，等待下一步指令
```

---

# 3. 输出协议（Output Protocol）

PocketChat 的输出包括：

- 代码
- 文档
- 目录结构
- API 封装
- 组件拆分
- i18n 文案
- Query 封装
- 工具函数
- 架构说明

## 3.1 输出模式启动

用户：

```
接下来你将分段输出 PocketChat 的代码或文档。
每次只输出我指定的部分。
等待我说「继续」再继续。
```

AI：

```
已进入 PocketChat 输出模式
```

---

## 3.2 输出规则

AI 必须：

- 每次只输出用户指定的文件或章节
- 不得提前输出后续内容
- 不得合并多个文件
- 不得跳过步骤
- 不得改变目录结构

---

# 4. 校验协议（Validation Protocol）

PocketChat 的代码生成需要高稳定性，因此 AI 必须提供校验。

## 4.1 输入校验
每段输入后 AI 必须：

- 回显段号  
- 回显累计段数  
- 回显累计字数（可选）  

示例：

```

已记录第4段（累计4段，约 8,120 字）

```

---

## 4.2 输出校验
AI 必须确保：

- 代码可运行  
- 目录结构正确  
- 导出路径正确  
- i18n 文案格式正确  
- API 封装符合 PocketChat 风格  
- Query 封装符合 PocketChat 风格  

---

# 5. 错误恢复协议（Recovery Protocol）

当 AI 出现：

- 输出错乱  
- 跳过步骤  
- 提前输出  
- 风格不一致  
- 结构错误  

用户发送：

```

你已偏离 PocketChat 协议，请执行错误恢复：

1. 回到上一个稳定状态
2. 重申你当前的任务
3. 等待我的下一条指令

```

AI 必须回复：

```

已恢复至上一个稳定状态。 当前任务：…… 等待你的下一条指令。

```

---

# 6. PocketChat 代码生成协议（Code Generation Protocol）

这是本协议的核心部分。

## 6.1 目录结构规则
AI 必须遵守：

```

vue3/ src/ api/ queries/ components/ composables/ stores/ lib/ utils/ pages/

````

不得创建未出现过的目录。

---

## 6.2 API 封装规则
AI 必须：

- 使用 `pb.collection(Collections.Xxx)`  
- 使用 `fetchWithTimeoutPreferred`  
- 返回 pbRes  
- 放在 `src/api/xxx.ts`  
- 使用 kebab-case 文件名  

示例格式：

```ts
export const pbUsersGetOneApi = async (id: string) => {
  const pbRes = await pb.collection(Collections.Users).getOne(id, {
    fetch: fetchWithTimeoutPreferred,
  })
  return pbRes
}
````

---

## 6.3 TanStack Query 封装规则

AI 必须：

- 使用 `useQuery`
- queryKey 使用 queryKeys
- retry 使用 queryRetryPbNetworkError
- 放在 `src/queries`
- 文件名 kebab-case

---

## 6.4 组件生成规则

AI 必须：

- 使用 `<script setup lang="ts">`
- 使用 PascalCase 文件名
- 使用 kebab-case 文件夹
- 使用 index.ts 导出

---

## 6.5 i18n 文案生成规则

AI 必须：

- 使用 `i18nStore.t('xxx')()`
- 文案格式必须与用户示例一致
- 多语言必须完整

---

# 7. PocketChat 文档生成协议（Doc Generation Protocol）

AI 必须生成：

- Markdown
- 标题层级正确
- 目录结构清晰
- 与 README_CN.md 风格一致

---

# 8. 草稿压缩协议（Draft Compression Protocol）

当用户说：

```
帮我生成一些东西来涵盖、压缩当前内容
```

AI 必须：

- 生成结构化摘要
- 保留关键技术点
- 保留目录结构
- 保留关键代码习惯
- 适合放入草稿文件

---

# 9. dev-flatten-text-to-ai.js 协议（Flatten Input Protocol）

AI 必须理解：

- 用户会将多个文件 flatten 后输入
- AI 必须能处理混合内容
- AI 不得混淆文件来源
- AI 必须等待用户指令再处理

---

# 10. 附录：启动命令

## 启动 PocketChat 专用协议

用户发送：

```
启用 PocketChat 专用协议
```

AI 回复：

```
PocketChat 专用协议已启用，请输入你的任务。
```

---

# 🎉 完成

这份协议已经完全适配你的 PocketChat 项目，可以长期使用、长期维护、长期扩展。

如果你愿意，我还能继续为你生成：

- **PocketChat 代码生成协议（更细化版）**
- **PocketChat 文档生成协议（更细化版）**
- **PocketChat 组件生成协议**
- **PocketChat API 生成协议**
- **PocketChat Query 生成协议**
- **PocketChat i18n 文案生成协议**

你想继续扩展哪一部分？